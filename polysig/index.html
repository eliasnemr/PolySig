<!DOCTYPE html>
<!-- PolySig, Version 1.0 -->
<!-- Created by Elias Nemr -->
<!-- Minima, Global -->
<!-- github.com/eliasnemr -->
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title></title>
        <base href=".">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="css/styles.css">
        <link rel="stylesheet" href="css/custom.css">
        <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    </head>
    <body>
        <script>
            $(document).ready(function() {

                //$('.carousel').carousel();

                Minima.init(function(msg){
                    if (msg.event == "connected") {
                        const TABLE = 'CREATE TABLE IF NOT EXISTS CONTRACTS (id int NOT NULL, address VARCHAR(160), timestamp VARCHAR(160), keys VARCHAR(160) NOT NULL, users VARCHAR(160) NOT NULL);SELECT * FROM CONTRACTS';
                        Minima.sql(TABLE, function(res){
                            if (res.status) {
                                // console.log('Created Contracts SQL Table');
                            }
                        });
                    }
                });
            });
        </script>
        <script>
            // Transitions
            document.addEventListener("DOMContentLoaded", function(){

                let txnID = "";
                let inp = 1;
                let input = {id: "", signees: "", min: "", users: [], keys: [], inputs: [], total: 0}; 
                let output = {amount: 0, address: "", tokenid: "", keys: { id: [], proof: ""} };

                const menu = document.getElementById("start-menu-title");
                const help = document.getElementById("help-menu-title");
                const createBtn = document.getElementById("btnWrap1");
                const provideBtn = document.getElementById("btnWrap2");
                const helpBtn = document.getElementById("helpBtn");
                const helpDiv = document.getElementById("help");

                $('#tutorialBtn').on('click', function() {
                    $('#tutorial').addClass('hide');
                    // set seen as true, add to Minima.file..
                });
                $('#tutorialClose3').on('click', function(){
                    $('#tutorial').addClass('hide');
                });
                $('#tutorialClose2').on('click', function(){
                    $('#tutorial').addClass('hide');
                });
                $('#tutorialClose').on('click', function(){
                    $('#tutorial').addClass('hide');
                });
                $('#carouselNext1').on('click', function(){
                    $('.carousel.carousel-slider').carousel('next');
                });

                $('#homeBtn').on('click', function(){
                    setTimeout(() => {
                        menu.classList.add("scale-in");
                        createBtn.classList.add("scale-in");
                        provideBtn.classList.add("scale-in");

                        $('#s-menu').css("display", "block");
                        $('#s-help').css("display", "none");

                    }, 150);

                });
                $('#homeBtn2').on('click', function(){
                    setTimeout(() => {
                        menu.classList.add("scale-in");
                        createBtn.classList.add("scale-in");
                        provideBtn.classList.add("scale-in");

                        $('#s-menu').css("display", "block");
                        $('#s-create').css("display", "none");

                    }, 150);

                });
                $('#homeBtn3').on('click', function(){

                    $('#s-create').css('display', 'block');
                    $('#s-stage1').addClass('hide');

                });
                $('#homeBtn4').on('click', function(){

                    if(!$('#continueBtnWrapper').hasClass('hide')) {
                        $('#continueBtnWrapper').addClass('hide');
                    }

                    if(!$('#postContractWrapper').hasClass('hide')) {
                        $('#postContractWrapper').addClass('hide');
                    }

                    $('#s-stage1-2').addClass('hide');
                    $('#s-stage1').removeClass('hide');
                });
                $('#homeBtn5').on('click', function(){
                    $('#s-contracts').addClass('hide');
                    $('#s-menu').css('display', 'block');
                });
                $('#createBtn').on('click', function(){

                    setTimeout(() => {
                        menu.classList.add("scale-out");
                        createBtn.classList.add("scale-out");
                        provideBtn.classList.add("scale-out");


                        $('#s-menu').css("display", "none");
                        $('#s-create').css("display", "block");

                    }, 75);
                    

                });

                function m_exportFunction() {
                    var html = `<ul class="coll-tip1 collection with-header">
                        <li class="collection-header"><h4>Tip #1 &mdash; Inputs</h4></li>
                        <li class="collection-item">To obtain your partner's coins use these functions in your MINI terminal</li>
                        <li class="collection-item">&mdash; <a onclick="m_exportFunction()" href=''>exportcoin</a> <span id="descr">[coinid] - export the proof of a single coin. Share it.</span></li>
                        <li class="collection-item">&mdash; <a href=''>importcoin</a> <span id="descr">[data] - Import the proof of a coin.</span></li>
                        <li class="collection-item">&mdash; <a href=''>keepcoin</a>  <span id="descr">[coinid] - Add a coin to the list of coins you keep track of. MUST be a recent coin in the current blocks.</span></li>
                    </ul>`;
                    $('#s-tip1 > #coll-tip1').remove();

                }
                function copyText(id) {

                    var str = document.getElementById(id).value;

                    const el = document.createElement('textarea');
                    el.value = str;
                    document.body.appendChild(el);
                    el.select();
                    document.execCommand('copy');
                    document.body.removeChild(el);

                    /* Alert the copied text */
                    M.toast({html: "Copied to clipboard.", classes: "success"});

                }
                function copyBase64(data) {

                    const el = document.createElement('textarea');
                    el.value = data;
                    document.body.appendChild(el);
                    el.select();
                    document.execCommand('copy');
                    document.body.removeChild(el);

                    M.toast({html: "Copied Package to Clipboard", classes: "success"});
                    
                }
                function addContract(id, txpow, timestamp, users) {

                    Minima.sql('INSERT INTO CONTRACTS VALUES(')


                }
                
                $('#proceedBtn').on('click', function(){

                    $('#participants > ul:last-child').empty();

                    let confirmed = false;
                    var users = $('#users').val();
                    users = parseInt(users);
                    var minimum = $('#minimum').val();
                    minimum = parseInt(minimum);

                    $('#modalCreate').modal({
                        dismissible: false,
                        opacity: 0.2,
                        onOpenStart: function() {

                            $('#confirm').on('click', function(){
                                confirmed = true;
                            });

                            if(users >= 2 &&  minimum <= users) {
                                $('#confirm').removeClass('hide');
                                $('#m-contractHeader').text('Continue?');
                                $('#m-contractHeader').css("color", "rgb(86,138,119)");
                                $('#m-contractType').text('This is a ' + minimum +'/'+ users + " multi-signature contract.");
                            } else {
                                $('#confirm').addClass('hide');
                                $('#m-contractHeader').text('Invalid Contract.');
                                $('#m-contractHeader').css("color", "rgb(173,74,83)");
                                $('#m-contractType').text("You need at least 2 Signees and less than or equal amounts of minimum signatures to unlock this contract.");
                            }

                        },
                        onCloseEnd: function() {
                            if(confirmed) {
                                input.signees = users;
                                input.min = minimum;
                                let json = JSON.stringify(input);
                                Minima.file.save(json, "inputs.txt", function(res){
                                    if (res.success) {
                                        $('#s-create').css("display", "none");
                                        $('#s-stage1').removeClass('hide');

                                        for (let i = 0; i < input.signees; i++) {

                                            let markup = 
                                                    '<li class="collection-item user-item">'+
                                                        '<div class="card blue-grey darken-1">'+
                                                            '<div class="card-image">'+
                                                                '<i class="material-icons">portrait</i>'+
                                                            '</div>'+
                                                            '<div class="card-content">'+
                                                                '<div class="input-field">'+
                                                                    '<input id="name'+i+'" type="text"/>'+
                                                                    '<label for="name'+i+'">Name</label>'+
                                                                '</div>'+
                                                                '<div class="input-field">'+
                                                                    '<input id="key'+i+'" type="text"/>'+
                                                                    '<label for="key'+i+'">Public key</label>'+
                                                                '</div>'+
                                                            '</div>'+
                                                        '</div>'+
                                                    '</li>';
                                            $('#participants > ul:last-child').append(markup);
                                        }

                                    } else {
                                        alert("Minima is offline...");
                                    }
                                });
                            }
                        }
                    }); 
                });
                $('#proceedBtnStage1').on('click', function(){
                    
                    if(!$('#copyPackageWrapper').hasClass('hide')) {
                        $('#copyPackageWrapper').addClass('hide');
                    }

                    // reset
                    input.users = [];
                    input.keys = [];
                    // declaring temporary Arrays
                    let idArr = [];
                    let valueArr = [];

                    $('#participants ul').find('li input[type="text"]').each(function() {
                        if($(this)[0].id.substring(0,4) == "name"){
                            input.users.push($(this)[0].value);

                        } else if($(this)[0].id.substring(0,3) == "key") {
                            input.keys.push($(this)[0].value);
                        }
                        
                    });

                    let json = JSON.stringify(input);
                    Minima.file.save(json, "inputs.txt", function(res){
                        if(res.success) { 
                            $('#participants ul').find('li input[type="text"]').each(function() {
                                // clear inputs
                                $(this)[0].value = "";  
                            });

                            $('#s-stage1').addClass('hide');
                            $('#s-stage1-2').removeClass('hide');

                            if($('#multiSigScript').length > 0) {
                                $('#multiSigScript > :last-child').remove();
                            }

                            Minima.file.load("inputs.txt", function(file){
                                if(file.success) {
                                    const keys = JSON.parse(file.data);
                                    let script = "";
                                    let allKeys = "";
                                    input.keys.forEach((id, i) => {
                                        if(input.keys.length == i+1) {
                                            allKeys += id;
                                        } else {
                                            allKeys += id + " ";
                                        }
                                    });
                                    script = "RETURN MULTISIG("+input.min+" "+allKeys+")";
                                    
                                    Minima.cmd('newscript "'+script+'"', function(res){
                                        if(res.status) {
                                            const markup = 
                                            "<div class='row'>"+
                                                "<div class='col s12'>"+
                                                    "<div id='scriptWrapper'>"+
                                                        "<div>"+
                                                            "<p>"+script+"</p>"+
                                                            "<i class='material-icons'>arrow_forward</i>"+
                                                            "<input id='proofAddress' class='center-align' disabled value='"+res.response.address.hexaddress+"'/>"+
                                                        "</div>"+
                                                    "</div>"+
                                                "</div>"+
                                            "</div>";
                                            
                                            $('#copyPackageWrapper').removeClass('hide');
                                           
                                            $('#multiSigScript').append(markup);
                                            output.proof = res.response.address.hexaddress;
                                            let json = JSON.stringify(output);
                                            Minima.file.save(json, "output.txt", function(){});
                                        }
                                    });
                                    

                                }

                            });
                        }
                    });

                    

                });
                $(document).on('click', "#copyAddress", function(){
                                        
                    // creating json package
                    let data = {
                        type: "",
                        message: "",
                        keys: [],
                        users: [],
                        hexaddress: "",
                    }

                    // set the json package.
                    data.type = "Script To Address";
                    data.message = "You are about to save a new script address in your script address";
                    data.keys = input.keys;
                    data.users = input.users;
                    data.hexaddress = output.proof;
                    // stringify the json package.
                    data = JSON.stringify(data);
                    // convert to base64.
                    data = btoa(data);
                    // copy to clipboard.
                    copyBase64(data);
                    // Display Script
                    $('#multiSigScript > :last-child').remove();

                    $('#copyPackageWrapper').addClass('hide');
                    $('#continueBtnWrapper').removeClass('hide');

                    let markup = 
                            '<div class="row">'+
                                '<div class="col s12">'+
                                    '<div id="toSendWrapper">'+
                                        '<div>'+
                                            '<p>How much Minima would you like to spend in this contract?</p>'+
                                            '<div class="input-field">'+
                                                '<input id="toSend" type="number"/>'+
                                                '<label for="toSend">Total amount to spend</label>'+
                                            '</div>'+
                                        '</div>'+
                                    '</div>'+
                                '</div>'+
                            '</div>';

                    $('#multiSigScript').append(markup);

                    // Change title
                    const title = '<i id="info" class="tiny material-icons" style="margin: 0;">info</i> Now that all your participant(s) are tracking this contract, let us continue...';
            
                    $('#s-stage1-2 #create-menu-title h1').html(title);
                    
                });
                $(document).on('click', '#endStageBtn1', function(){

                    // amount user wants to spend
                    let amnt = 0;

                    // signees
                    let signee = "";

                    amnt = $('#toSend').val();

                    // creating json package
                    let data = {
                        type: "",
                        message: "",
                        keys: [],
                        users: [],
                        hexaddress: "",
                    }
                    
                    // Create random ID
                    const id = Math.floor(Math.random()*1000000000);
                    
                    input.id = id;
                    let json = JSON.stringify(input);
                    Minima.file.save(json, 'inputs.txt', function(){});

                    // Create and post transaction
                    const txn = 'txncreate '+id+';'+
                                "txnstate "+id+" "+125+" "+input.signees+';'+
                                "txnstate "+id+" "+126+" "+input.min+';'+
                                'txnauto '+id+' '+amnt+' '+output.proof+' '+'0x00';
                              

                    input.keys.forEach((key, i) => {
                        signee += 
                        '<li class="collection-item contract-item"><div>Signee #'+i+'&mdash;'+input.users[i]+'</div><a id="users" class="secondary-content">'+key+'</a></li>';
                    });

                    // Change title
                    const title = '<i id="info" class="tiny material-icons" style="margin: 0;">info</i> This is your contract.  Post when ready!';
                                
                    $('#s-stage1-2 #create-menu-title h1').html(title);
                              
                    // Create Transaction...
                    Minima.cmd(txn, function(res) {
                        // check all responses..
                        if (Minima.util.checkAllResponses(res)) {
                            // show Btn
                            $('#postContractWrapper').removeClass('hide');
                            // hide this btn
                            $('#continueBtnWrapper').addClass('hide');
                            
                            M.toast({html: "Completed Contract...", classes:"success"});

                            $('#multiSigScript > :last-child').remove();

                            $('#s-stage1-2 > .row .col #titles').html("Your <span id='brand' style='width: 30px;'>Polysig</span> Contract");

                            let markup =
                                    '<div class="row">'+
                                        '<div class="col s12">'+
                                            '<div class="card contract-card">'+
                                                '<div class="card-image">'+
                                                    '<span class="card-title contractId">#'+id+'</span>'+'<br>'+
                                                '</div>'+
                                                '<div class="card-content">'+
                                                    '<div class="contract-amnt">'+
                                                        '<h4>'+
                                                            amnt+
                                                        '</h4>'+
                                                        '<p>This is the total amount you are using in your contract.</p>'+
                                                    '</div>'+
                                                    '<ul class="collection">'+
                                                        '<li class="collection-item"><div>Participating Users</div><a id="users" class="secondary-content">'+input.users+'</a></li>'+
                                                        '<li class="collection-item"><div>Minimum required signee(s)</div><a id="users" class="secondary-content">'+input.min+'</a></li>'+
                                                    '</ul>'+
                                                    '<ul class="collection with-header collection-keys">'+
                                                        '<li class="collection-header contract-header">Signee(s)</li>'+
                                                        signee+
                                                    '</ul>'+
                                                '</div>'+
                                            '</div>'+
                                        '</div>'+
                                    '</div>';
                            $('#multiSigScript').append(markup);


                        } else {
                            M.toast({html: "Transaction failed to post..."});
                        }

                    });

                });
                $('#postBtn').on('click', function() {
                    // remove contract
                    $('#multiSigScript > :last-child').remove();
                    // hide btn
                    $('#postContractWrapper').addClass('hide');
                    // hide section
                    $('#s-stage1-2').addClass('hide');
                    // show main menu 
                    $('#s-menu').css('display', 'block');


                    Minima.file.load("inputs.txt", function(res){
                        if (res.success) {

                            var data = JSON.parse(res.data);

                            Minima.cmd('txnpost '+ data.id, function(resp){
                                if (resp.status) {
                                    M.toast({html: 'Success! Contract posted!', classes: 'success'});

                                    const INSERT = "INSERT INTO CONTRACTS VALUES ('";
                                    Minima.cmd('txnlist ' + input.id, function(respo) {
                                        console.log(respo);
                                        if (respo.status) {
                                            let users = JSON.stringify(input.users);
                                            let keys = JSON.stringify(input.keys);
                                            let date = Date.now().toString();
                                            Minima.sql(INSERT+input.id+"', '"+output.proof+"', '"+date+"', '"+keys+"', '"+users+"')", function(response){
                                                if (response.status) {
                                                    Minima.cmd('txndelete '+input.id, function(){});
                                                }
                                            });
                                }
                                
                            });

                                }
                            })
                            

                        }
                    }); 
                });

                /** Contracts */
                $('#provideBtn').on('click', function() {
                    $('#s-menu').css("display", "none");
                    $('#s-contracts').removeClass("hide");

                    $('#contract').empty();
                    Minima.sql("SELECT * FROM CONTRACTS", function(res){
                        console.log(res);
                        if (res.status && res.response.rows.length > 0) {
                            $('#contracts > ul > .collection-header').text('Contracts');
                            $('#contracts > ul > .collection-header').css("color", "rgb(188,192,194)");
                            $('#contracts > ul > .collection-header').css("font-size", "1.5rem");
                            // retrieve data and fill activities
                            res.response.rows.forEach((row, i) => {
                                const json = JSON.parse(row.TXPOW);
                                
                                let markup = 
                                            '<li class="collection-item">'+
                                                '<div class="card blue-grey darken-1">'+
                                                    '<div class="card-content white-text">'+
                                                        '<span class="card-title"><span id="brand">#</span>'+row.ID+'</span>'+
                                                        '<p id="contractType">'+json.transaction.state[0].data+'/'+json.transaction.state[1].data+' MultiSignature Contract.</p>'+
                                                        '<p id="timestamp">'+ moment(parseInt(row.TIMESTAMP)).format("MMMM Do YYYY &#8212; HH:mm:ss a") +'</p>'+
                                                    '</div>'+
                                                    '<div class="card-action">'+
                                                        '<a id="'+row.ID+'" class="viewContract">View Contract</a>'+
                                                    '</div>'+
                                                '</div>'+
                                            '</li>';
                                $('#contract').append(markup);
                                
                            });


                        } else {
                            $('#contracts > ul > .collection-header').text("No contracts found!");
                            $('#contracts > ul > .collection-header').css("color", "#736AB6");
                            $('#contracts > ul > .collection-header').css("font-weight", "800");

                        }

                    });
                    
                    
                   

                });
                $(document).on('click', '.viewContract', function(){

                    console.log($(this).attr('id'));
                    let id = $(this).attr('id');
                    // Show details of this txnlist..
                    Minima.sql('SELECT * FROM CONTRACTS WHERE ID='+id, function(res){
                        if (res.status && res.response.rows.length > 0) {
                            console.log(res);
                            $('#contract').addClass('hide');
                            $('#contract-details').removeClass('hide');
                            
                            let inputs = "";
                            let outputs = "";
                            let json = JSON.parse(res.response.rows[0].TXPOW);
                            
                            json.transaction.inputs.forEach((input, i) => {
                                inputs += 
                                        '<li class="collection-item c-details-item">'+
                                            '<span id="title"><span id="brand" style="font-size: 1.3rem;">#</span>'+ i +'</span>'+
                                            '<p>'+input.coinid+'</p>'+
                                            '<a id="amnt">'+input.amount+'</a>'
                                        '</li>';
                            });
                            json.transaction.outputs.forEach((output, i) => {
                                outputs += 
                                        '<li class="collection-item c-details-item">'+
                                            '<span id="title"><span id="brand" style="font-size: 1.3rem;">#</span>'+ i +'</span>'+
                                            '<p>Recipient Address &mdash; '+output.address+'</p>'+
                                            '<a id="amnt">'+output.amount+'</a>'
                                        '</li>';
                            });

                            let markup = 
                                        '<li class="collection-item">'+
                                            '<div class="card blue-grey darken-1">'+
                                                '<div class="card-content white-text">'+
                                                    '<span class="card-title"><span id="brand">#</span>'+res.response.rows[0].ID+'</span>'+
                                                    '<p id="contractType">'+json.transaction.state[0].data+'/'+json.transaction.state[1].data+' MultiSignature Contract.</p>'+
                                                    '<p id="timestamp">'+ moment(parseInt(res.response.rows[0].TIMESTAMP)).format("MMMM Do YYYY &#8212; HH:mm:ss a") +'</p>'+
                                                    '<hr>'+
                                                    '<ul class="collection with-header">'+
                                                        '<li class="collection-header contract-header" style="color: #000 !important;">Contract Details</li>'+
                                                        '<ul class="collection with-header"><li class="collection-header c-details-header">Signatures</li><li class="collection-item c-details-item">Signed by '+json.witness.signatures.length+'</li></ul>'+
                                                        '<ul class="collection with-header"><li class="collection-header c-details-header">Inputs</li>'+inputs+'</ul>'+
                                                        '<ul class="collection with-header"><li class="collection-header c-details-header">Outputs</li>'+outputs+'</ul>'+

                                                    '</ul>'+
                                                '</div>'+
                                                '<div class="card-action">'+
                                                    '<a id="backToContracts">Back to Contracts</a>'+
                                                '</div>'+
                                                '</div>'+
                                        '</li>';
                            $('#contract-details').append(markup);
                            
                            

                        }
                    });

                });
                $(document).on('click', '#backToContracts', function(){
                    $('#contract-details').empty();
                    $('#contract').removeClass("hide");
                    $('#contract-details').addClass("hide");
                })
                /** TOOLS */
                $('#tools').on('click', function() {

                    $('#toolsMenu').toggleClass('active');
                    
                    if ($('#toolsMenu').hasClass('active')) {
                        $('#tools').text("Hide Tools");
                    } else {
                        $('#tools').text("Tools");

                    }

                });
                $('#toolsClose').on('click', function(){
                    
                    $('#toolsMenu').toggleClass('active');
                    
                    if ($('#toolsMenu').hasClass("active")) {
                        $('#tools').text("Hide Tools");
                    } else {
                        $('#tools').text("Tools");
                    }
                    
                    
                });
                $('#coinsBtn').on('click', function(){
                    
                    if($('#coinsTool').hasClass("hide") && !$('#importTool').hasClass('hide')) {
                        $('#importTool').addClass('hide');
                        $('#coinsTool').removeClass("hide");
                    } else if($('#coinsTool').hasClass("hide") && !$('#generateTool').hasClass('hide')) {
                        $('#generateTool').addClass('hide');
                        $('#coinsTool').removeClass("hide");
                    } else {
                        $('#coinsTool').removeClass("hide");
                    }

                });
                $(document).on('click', '#coinClose', function() {
                    $('#coinsTool').addClass("hide");
                })
                $(document).on('click', '#copyCoin', function(){
                    var id = $(this).text();

                    const el = document.createElement('textarea');
                    el.value = id.substring(0, id.length-12);
                    document.body.appendChild(el);
                    el.select();
                    document.execCommand('copy');
                    document.body.removeChild(el);

                    /* Alert the copied text */
                    M.toast({html: "Copied to clipboard.", classes: "success"});
                });
                $('#getCoins').on('click', function() {

                    $('.tokenCoins').empty();

                    var tokenid = $('#tokenID').val();
                    if(tokenid.length == 0){
                        return M.toast({html:"Your input field's empty!"});
                    }
                    Minima.cmd("coinsimple "+ tokenid, function(res){
                        
                        if (res.status) {
                            const len = res.response.coins.length;
                            if (len && len > 1){
                                $('#tokenCoinsWrapper .collection-header h2').text(res.response.coins.length + " coins found!");
                            } else if (len && len == 1) {
                                $('#tokenCoinsWrapper .collection-header h2').text(res.response.coins.length + " coin found!");
                            } else {
                                $('#tokenCoinsWrapper .collection-header h2').text("No coins found for this token.");
                            }

                            res.response.coins.forEach(c => {

                                if (c.coin.amount > 0) {

                                    let markup = "<li class='collection-item'><div>"+
                                        c.coin.coinid.substring(0, 10)+"..."+c.coin.coinid.substring(c.coin.coinid.length-10, c.coin.coinid.length)+
                                        "<span id='copyCoin' class='valign left'><span style='display:none;'>"+c.coin.coinid+"</span><i class='material-icons'>content_copy</i></span>"+
                                        "<a class='secondary-content right'>"+c.coin.amount+"</a></div></li>";
                                    
                                    $('.tokenCoins').append(markup);                          
                                }


                            });


                        }

                    });

                    $("#tokenCoinsWrapper").removeClass("hide");

                });
                
                $('#genBtn').on('click', function(){
                    
                    if ($('#generateTool').hasClass("hide") && !$('#coinsTool').hasClass('hide') ) {
                        $('#coinsTool').addClass('hide');
                        $('#generateTool').removeClass("hide");
                    } else if ($('#generateTool').hasClass("hide") && !$('#importTool').hasClass('hide')) {
                        $('#importTool').addClass('hide');
                        $('#generateTool').removeClass("hide");
                    } else {
                        $('#generateTool').removeClass("hide");
                    }
                });
                $('#copyKey').on('click', function(){

                    copyText("pubKey");

                });
                $('#newKey').on('click', function(){

                    Minima.cmd('keys new', function(res){

                        if (res.status) {

                            $('#pubKey').val(res.response.key.publickey);

                            M.updateTextFields();

                        }

                    }); 

                });
                $(document).on('click', '#genClose', function() {
                    $('#generateTool').addClass("hide");
                })
                
                $('#impBtn').on('click', function() {

                    if ($('#importTool').hasClass('hide') && !$('#coinsTool').hasClass('hide')) {
                        $('#coinsTool').addClass('hide');
                        $('#importTool').removeClass("hide");
                    } else if($('#importTool').hasClass('hide') && !$('generateTool').hasClass('hide')) {
                        $('#generateTool').addClass("hide");
                        $('#importTool').removeClass("hide");
                    } else {
                        $('#importTool').removeClass("hide");
                    }
                    

                });
                $('#importTransaction').on('click', function(){
                    // remove older 
                    if ($("#importedFormContract").length > 0 && !$('#freshExportContract').length > 0) {
                        $('#importedFormContract').remove();
                    } else if($('#freshExportContract').length > 0) {
                        $('#freshExportContract').remove();
                    }
                    if ($('#importedData').val().length > 0){
                        const txnID = Math.floor(Math.random()*1000000000);
                        const data = $('#importedData').val();

                        Minima.cmd('txnimport ' + txnID + " " + data, function(res){

                            if (Minima.util.checkAllResponses(res)) {
                                M.toast({html: "Transaction imported with id: "+txnID, classes: "success"});
                            }

                        });

                       const importedTransaction = {id: txnID, data: data};
                       console.log(importedTransaction);
                       const json = JSON.stringify(importedTransaction);
                        Minima.file.save(json, "imported.txt", function(res){
                            if (res.success){

                                Minima.file.load("imported.txt", function(res) {
                                    const result = JSON.parse(res.data);
                                    if (res.success) {
                                        Minima.cmd("txnlist "+result.id, function(resp){
                                            console.log(resp);
                                            let inputs = "";
                                            let outputs = "";
                                            let total = 0;
                                            resp.response.transaction.transaction.inputs.forEach((input, i) => {
                                                inputs += "<li class='collection-item contract-item'><h4>Coin #"+i+
                                                    "</h4><p>"+
                                                    input.address.substring(0,10)+"..."+
                                                    input.address.substring(input.address.length-10, input.address.length)+
                                                    "</p><p style='color: rgb(205,197,216); font-weight: 400;'>"+
                                                    input.amount+
                                                    "</p></li>";
                                                total += parseFloat(input.amount);
                                            });

                                            resp.response.transaction.transaction.outputs.forEach((output, i) => {
                                                outputs += "<li class='collection-item contract-item'><div><h6>#"+
                                                    i+
                                                    "</h6>"+
                                                    "<p>"+
                                                    output.address+
                                                    "</p><p style='color: rgb(231,241,254);'>"+
                                                    output.amount + 
                                                    "</p></div></li>";
                                            });
                                            
                                            var markup = 
                                                "<div id='importedFormContract' class='card contract-card hoverable'>"+ 
                                                "<div class='card-image'>"+
                                                    "<img src='assets/diego.jpg' style='height: 150px;'>"+
                                                    "<div class='card-title'><h6 id='titles'><img class='left' style='width: 25px; margin-right: 5px; ' src='assets/polysig.png'>Imported <span id='brand' >PolySig</span> Contract</h6></div>"+
                                                "</div>"+
                                                "<div class='card-content contract-content'>"+
                                                "<ul class='collection with-header contract-collection'>"+
                                                    "<li class='collection-header contract-header'>Contract Details</li>"+
                                                    "<li id='contractDescr0' class='collection-item contract-item'><h4>Transaction ID</h4><p>"+resp.response.transaction.id+"</p></li>"+
                                                    "<li id='contractDescr1' class='collection-item contract-item'><h4>Signees</h4><p>This is a "+resp.response.transaction.transaction.state[0].data+"/"+resp.response.transaction.transaction.state[1].data+" MultiSignature Contract.</p></li>"+
                                                    "<li id='contractDescr2' class='collection-item contract-item'><h4 class='activator'>Amount of coins<i class='material-icons right'>more_vert</i></h4><p>"+resp.response.transaction.transaction.inputs.length+"</p></li>"+
                                                    "<li id='contractDescr3' class='collection-item contract-item'><h4>Total</h4><input id='amountToSend' type='number' disabled placeholder='0' value='"+total+"'></li>"+
                                                "</ul>"+
                                                "<ul class='collection with-header contract-collection'><li class='collection-header contract-header'>Outputs</li>"+
                                                outputs+ 
                                                "</ul>"+
                                                "</div>"+
                                                "<div class='card-reveal'>"+
                                                    "<span class='card-title grey-text text-darken-4'>Contract's Selected Coins<i class='material-icons right'>close</i></span>"+
                                                    "<br>"+
                                                    "<ul class='collection' id='chosenCoinsWrapper2'>"+
                                                    "</ul>"+
                                                "</div>"+
                                                "<div class='card-action'>"+
                                                    "<div id='exportSignedContract' class='btn-flat waves-light waves-effect waves-block'>"+
                                                        "Sign and Export"+
                                                    "</div>"+
                                                "</div>"+
                                                "</div>";

                                            $('#importedForm').after(markup);

                                            // Fill Chosen Coins in Contract
                                            setTimeout(() => {
                                                $('#chosenCoinsWrapper2').empty();
                                                if ($('#chosenCoinsWrapper2').length > 0) {
                                                    $('#chosenCoinsWrapper2:last-child').append(inputs);
                                                } 
                                            }, 1000);

                                        });
                                    }
                                });

                            }
                        })

                    } else {
                        M.toast({html: "Empty input fields!"});
                    }
                    

                });
                $(document).on('click', '#exportSignedContract', function(){
                    Minima.file.load('imported.txt', function(res){
                        const s = JSON.parse(res.data);
                        if (res.success) {
                            Minima.cmd('txnsignauto '+s.id+';'+'txnexport '+s.id+';'+'txndelete '+s.id, function(resp){
                                
                                M.toast({html: "Exported Contract with id: "+s.id, classes: "success"});

                                let markup = 
                                "<div id='freshExportContract' class='card contract-card hoverable'>"+ 
                                "<div class='card-image'>"+
                                    "<img src='assets/diego.jpg' style='height: 150px;'>"+
                                    "<div class='card-title'><h6 id='titles'><img class='left' style='width: 25px; margin-right: 5px; ' src='assets/polysig.png'>Exported <span id='brand' >PolySig</span> Contract</h6></div>"+
                                "</div>"+
                                "<div class='card-content contract-content'>"+
                                "<ul class='collection with-header contract-collection'>"+
                                    "<li class='collection-header contract-header'>Send this back to the Contract Agent.</li>"+
                                    "<li id='contractDescr0' class='collection-item contract-item'><h4>Contract TXN ID</h4><p>"+s.id+"</p></li>"+
                                    "<li id='contractDescr1' class='collection-item contract-item'><h4>Exported Data</h4><p id='exportedDataClip'>"+ resp[1].response.transaction +"</p></li>"+
                                    
                                "</ul>"+
                                "</div>"+
                                
                                "<div class='card-action'>"+
                                    "<div id='copySignedContract' class='btn-flat waves-light waves-effect waves-block'>"+
                                        "Copy To Clipboard"+
                                "</div>"+
                                "</div>";


                                $('#importedFormContract').remove();

                                $('#importedForm').after(markup);

                            });
                        }

                    });

                });
                $('#i_clearInputs').on('click', function(){

                    $('#importedData').val("");
                    // remove older 
                    if ($("#importedFormContract").length > 0 && !$('#freshExportContract').length > 0) {
                        $('#importedFormContract').remove();
                    } else if($('#freshExportContract').length > 0) {
                        $('#freshExportContract').remove();
                    }


                });
                $(document).on('click', '#copySignedContract', function(){

                    var str = $('#exportedDataClip').text();

                    const el = document.createElement('textarea');
                    el.value = str;
                    document.body.appendChild(el);
                    el.select();
                    document.execCommand('copy');
                    document.body.removeChild(el);

                    /* Alert the copied text */
                    M.toast({html: "Copied to clipboard.", classes: "success"});

                });
                $('#impClose').on("click", function(){
                    $('#importTool').addClass('hide');
                })
                
                setTimeout(() => {
                    menu.classList.add("scale-in");
                    createBtn.classList.add("scale-in");
                    provideBtn.classList.add("scale-in");
                }, 300);
            });
        </script>

        <!-- Tutorial Overlay -->
        <div id="tutorial" class="carousel carousel-slider hide">
            <div id="first" class="carousel-item carousel-fixed-item" href="#one!">
                <span><a id="tutorialClose" class="right exit">&#10005;</a></span>
                <!-- helper div to fix valign issues -->
                <div class="row" style="position: relative; top:5%">
                    <div class="empty" style="height:35px;"></div>
                </div>
                <div class="row valign-wrapper">
                    <div class="col s12 center-align">
                        <h4>
                            <span id="brand" style="font-size: 2.5rem;">PolySig</span>
                        </h4>
                    </div>
                </div>
                <div class="row valign-wrapper">
                    <div class="col s12 center-align">
                        <img style="width: 180px;" src="assets/polysig.png" alt="logo">
                    </div>
                </div>
                
                <div class="row valign-wrapper">
                    <div class="col s12 center-align">
                        <h4>Welcome!</h4>
                        <p>Let's get started with a quick tutorial.</p>
                    </div>  
                </div>
                <div class="row valign-wrapper">
                    <div class="col s12 center-align">
                        <i id="carouselNext1" class="material-icons next">arrow_forward</i>
                    </div>
                </div>
            </div>
            <div id="second" class="carousel-item carousel-fixed-item" href="#two!">
                <span><a id="tutorialClose2" class="right exit">&#10005;</a></span>
                <!-- helper div to fix valign issues -->
                <div class="row" style="position: relative; top:5%">
                    <div class="empty" style="height:35px;"></div>
                </div>
                <div class="row valign-wrapper">
                    <div class="col s12 center-align">
                        <h4>
                            <span id="brand" style="font-size: 2.5rem;">PolySig</span>
                        </h4>
                    </div>
                </div>
                <div class="row valign-wrapper">
                    <div class="col s12 center-align">
                        <img style="width: 180px;" src="assets/coin.svg" alt="logo">
                    </div>
                </div>
                
                <div class="row valign-wrapper">
                    <div class="col s12 center-align">
                        <h4>Transactions</h4>
                        <p>Minima transactions are made up of inputs and outputs, where <span style="font-weight: bold;">coins</span> are inputs, and the output is the <span style="font-weight: bold">script address.</span></p>
                    </div>  
                </div>
                <div class="row valign-wrapper">
                    <div class="col s12 center-align">
                        <i class="material-icons next">arrow_forward</i>
                    </div>
                </div>
            </div>
            <div id="third" class="carousel-item carousel-fixed-item" href="#three!">
                <span><a id="tutorialClose3" class="right exit">&#10005;</a></span>
                <!-- helper div to fix valign issues -->
                <div class="row" style="position: relative; top:5%">
                    <div class="empty" style="height:35px;"></div>
                </div>
                <div class="row valign-wrapper">
                    <div class="col s12 center-align">
                        <h4>
                            <span id="brand" style="font-size: 2.5rem;">PolySig</span>
                        </h4>
                    </div>
                </div>
                <div class="row valign-wrapper">
                    <div class="col s12 center-align">
                        <img style="width: 180px;" src="assets/slot-machine.svg" alt="logo">
                    </div>
                </div>
                
                <div class="row valign-wrapper">
                    <div class="col s12 center-align">
                        <h4>MultiSig Contracts</h4>
                        <p>To spend a coin, the rightful owner must sign the transaction before posting it to the network.</p>
                        
                        <p>
                            Inputting these coins as input then outputting them to a newer transaction/contract, 
                            signed by 
                            <span style="font-weight:bold; font-style:italic">2(+)</span> out of 
                            <span style="font-weight:bold; font-style:italic">n</span> signatures,
                            will then make it only possible to be spent by the minimum needed signatures <span style="font-weight:bold">you</span> define in the transaction before.
                        </p>
                        

                    </div>  
                </div>
                <div class="row valign-wrapper">
                    <div class="col s12 center-align">
                        <i class="material-icons next">arrow_forward</i>
                    </div>
                </div>
            </div>
            <div id="fourth" class="carousel-item carousel-fixed-item" href="#four!">
                <span><a id="tutorialClose4" class="right exit">&#10005;</a></span>
                <!-- helper div to fix valign issues -->
                <div class="row" style="position: relative; top:5%">
                    <div class="empty" style="height:35px;"></div>
                </div>
                <div class="row valign-wrapper">
                    <div class="col s12 center-align">
                        <h4>
                            <span id="brand" style="font-size: 2.5rem;">PolySig</span>
                        </h4>
                    </div>
                </div>
                <div class="row valign-wrapper">
                    <div class="col s12 center-align">
                        <img style="width: 180px;" src="assets/rocket-ship.svg" alt="logo">
                    </div>
                </div>
                
                <div class="row valign-wrapper">
                    <div class="col s12 center-align">
                        <h4>Get Started!</h4>
                        <p>Let's create our very first contract!</p>
                    </div>  
                </div>
                <div class="row valign-wrapper">
                    <div class="col s12 center-align">
                        <a id="tutorialBtn" class="btn-flat waves-light waves-effect">Let's go.</a>
                    </div>
                </div>
            </div>
        </div>
        <a id="tools" class="btn-flat btn waves-effect waves-light waves-block">
            Tools
        </a>
        
        <div id="logo" class="row center-align no-padding">
            <div id="start-menu-title" class="start-menu col s12">
                <h1 id="brand">PolySig</h1>
            </div>
        </div>

        <div id="toolsMenu" class="center-align">
            <div class="row toolButtons z-depth-0">
                <div class="col s12">
                    <h2>Tools <a id="toolsClose" class="right exit">&#10005;</a></h2>
                </div>
            </div>
            
           
            <div class="row toolButtons z-depth-0">
                <div class="col s12 m6">
                    <a id="coinsBtn" class="waves-effect waves-light btn waves-block z-depth-1">Coins</a>
                </div>
                <div class="col s12 m6">
                    <a id="genBtn" class="waves-effect waves-light btn waves-block z-depth-1">Generate Key</a> 
                </div>
                <div class="col s12">
                    <a id="impBtn" class="waves-effect waves-light btn waves-block z-depth-1">TXN Import</a>    
                </div>
            </div>
            <div id="coinsTool" class="section hide">
                <div class="row">
                    <div class="col s12">
                        <span><a id="coinClose" class="right exit">&#10005;</a></span>
                        <div class="container">
                            <h4>Enter TokenID for the token you would like coin details for.</h4>
                            <div class="input-field">
                                <img src="assets/token.svg" class="prefix" style="width:22px;">
                                <input id="tokenID" type="text">
                                <label for="tokenID">Token ID</label>
                            </div>
                            <a id="getCoins" class="btn-small waves-light waves-effect z-depth-1">Get Coins</a>
                        </div>
                    </div>
                </div>
                <div id="tokenCoinsWrapper" class="row hide">
                    <div class="col s12">
                        <ul class="collection with-header">
                            <li class="collection-header z-depth-2"><h2>Coins Found</h2></li>
                            <div class="tokenCoins">
    
                            </div>
                        </ul> 
                    </div>
                </div>
            </div>   
            <div id="generateTool" class="section hide">
                <div class="row">
                    <div class="col s12">
                        <span><a id="genClose" class="right exit">&#10005;</a></span>
                        <div class="container">
                            <h4>Generate a new key below.</h4>
                            <div class="input-field">
                                <img src="assets/electronic-key.svg" style="width: 22px;" class="prefix" id="electronicKey" alt="Electronic Key">
                                <input id="pubKey" type="text">
                                <label for="pubKey">Public Key</label>
                                 <span id='copyKey' style="position: absolute" class='right'><i class='material-icons'>content_copy</i></span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col s12">
                        <a id="newKey" class="btn-small waves-light waves-effect z-depth-1">New Key</a>
                    </div>
                </div>
            </div>
            <div id="importTool" class="section hide">
                <div id="importedForm" class="row">
                    <div class="col s12">
                        <span><a id="impClose" class="right exit">&#10005;</a></span>
                        <div class="container">
                            <h4>Import a transaction, edit and sign and export when ready.</h4>
                        </div>
                    </div>
                    <div class="col s12">
                        <div class="input-field">
                            <img src="assets/import.svg" style="width: 22px;" class="prefix" id="importedTransaction" alt="Imported Transaction">
                            <input id="importedData" type="text">
                            <label for="importedData">Imported Transaction</label>
                        </div>
                    </div>
                    <div class="col s12">
                        <a id="importTransaction" class="btn-small waves-light waves-effect z-depth-1">Import Transaction</a>
                    </div>
                    <div class="col s12">
                        <a id="i_clearInputs" class="btn-flat waves-light waves-effect z-depth-1" >Clear Input</a>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="mainMenu" class="valign-wrapper">
            <!-- Main -->
            <div id="s-menu" class="center-align" style="width: 100%;">
                <div class="row center-align">
                    <div id="btnWrap1" class="col s6 offset-s3 scale-transition scale-out">
                        <a id="createBtn" class="btn-flat waves-block waves-effect waves-light polyBtn">
                            Create
                        </a>
                    </div>
                </div>
                <div class="row center-align">
                    <div id="btnWrap2" class="col s6 offset-s3 scale-transition scale-out">
                        <div id="provideBtn" class="btn-flat waves-block waves-effect waves-light polyBtn">
                            Contracts
                        </div>
                    </div>
                </div>
            </div>
            <!-- Create -->
            <div id="s-create" class="container" style="display: none;">
                <div class="row">
                    <div class="row right" style="position: absolute; right: 3px; top:10px;">
                        <div class="col s12">
                            <div id="homeBtn2" class="btn-flat waves-effect waves-light backBtn" style="vertical-align: middle">
                                <i id="forward" class="material-icons left no-padding">arrow_back</i>
                            </div>
                        </div>
                    </div>
                    <div id="create-menu-title" class="col s-12">
                        <h1>
                            <i id="info" class="tiny material-icons" style="margin: 0;">info</i> Let's choose how many participant(s) we want in this contract.
                        </h1>
                    </div>
                </div>
                <div id="signee" class="row">
                    <div class="input-field col s12 m6">
                        <i class="material-icons prefix">lock</i>
                        <input id="users" type="number" class="validate">
                        <label for="users">No. of Signee</label>
                    </div>
                    <div class="input-field col s12 m6">
                        <i class="material-icons prefix">lock_open</i>
                        <input id="minimum" type="number" class="validate">
                        <label for="minimum">Minimum signatures</label>
                    </div>
                </div>
                <div class="row">
                    <div class="col s10 offset-s1 center-align">
                        <a id="proceedBtn" class="btn-flat waves-effect waves-light modal-trigger polyBtn" href="#modalCreate">
                            <i id="forward" class="material-icons right no-padding">arrow_forward</i>Proceed
                        </a>
                    </div>
                </div>
               
            </div>
            <!-- Stage 1 -->
            <div id="s-stage1" class="container hide">
                <div class="row center-align">
                    <div class="row right" style="position: absolute; right: 3px; top:10px;">
                        <div class="col s12">
                            <div id="homeBtn3" class="btn-flat waves-effect waves-light backBtn" style="vertical-align: middle">
                                <i id="forward" class="material-icons left no-padding">arrow_back</i>
                            </div>
                        </div>
                    </div>
                    <div id="create-menu-title" class="col s-12">
                        <h1>
                            <i id="info" class="tiny material-icons" style="margin: 0;">info</i> Fill out your and your participant(s) details.
                        </h1>
                    </div>
                </div>
                <div class="row center-align">
                    <div id="participants" class="col s12">
                        <ul class="collection">
                            
                        </ul>
                    </div>
                </div>
                <div class="row">
                    <div class="col s10 offset-s1 center-align">
                        <a id="proceedBtnStage1" class="btn-flat waves-effect waves-light polyBtn">
                            <i id="forward" class="material-icons right no-padding">arrow_forward</i>Proceed
                        </a>
                    </div>
                </div>
            </div>
            <!-- Stage 1 - 2 -->
            <div id="s-stage1-2" class="container hide center-align">
                <div class="row center-align">
                    <div id="create-menu-title" class="col s-12">
                        <h1>
                            <i id="info" class="tiny material-icons" style="margin: 0;">info</i> This is your multi-signature address, Share this with your participant(s) so they can track this contract with you.
                        </h1>
                    </div>
                </div>
                <div class="row">
                    <div id="multiSigScript" class="col s12">
                        
                    </div>
                </div>

                <div id="copyPackageWrapper" class="row center-align hide">
                    <div class='col s12'>
                        <a id='copyAddress' class='btn-flat waves-effect waves-light polyBtn'>Copy Package</a>
                    </div>
                </div>
                <div id="continueBtnWrapper" class="hide row center-align">
                    <div class="col s12">
                        <a id="endStageBtn1" class="btn-flat waves-effect waves-light polyBtn">Continue</a>
                    </div>
                </div>
                <div id="postContractWrapper" class="hide row center-align">
                    <div>
                        <a id="postBtn" class="btn-flat waves-effect waves-light polyBtn">Post Contract</a>    
                    </div>
                </div>

                <div class="row center-align">
                    <div class="col s12 center-align">
                        <a id="homeBtn4" class="btn-flat waves-effect waves-light backBtn" style="vertical-align: middle">
                            <i id="forward" class="material-icons left no-padding">arrow_back</i>
                        </a>
                    </div>
                </div>
            </div>
            <!-- Posted  -->
            <div id="s-contracts" class="container hide center-align">
                <div class="row">
                    <div class="col s12">
                        <div id="contracts">
                            <ul class="collection with-header">
                                <li class="collection-header">Contract Activities</li>
                                <div id="contract">

                                </div>
                                <div id="contract-details" class="hide">
                                    
                                </div>
                            </ul>
                        </div>
                    </div>
                </div>

                <div class="row center-align">
                    <div class="col s12">
                        <div id="homeBtn5" class="btn-flat waves-effect waves-light backBtn" style="vertical-align: middle">
                            <i id="forward" class="material-icons left no-padding">arrow_back</i>
                        </div>
                    </div>
                </div>
            </div>
            
        
    </div>

    <!-- Custom Modal 1 -->
    <div id="modalCreate" class="modal">
        <div class="modal-content">
            <h4 id="m-contractHeader"></h4>
            <p id="m-contractType"></p>
        </div>
        <div class="modal-footer">
            <a class="modal-action modal-close waves-effect waves-red btn-flat ">Cancel</a>
            <a id="confirm" class="hide modal-action modal-close waves-effect waves-green btn-flat">Confirm</a>
        </div>
    </div>
    <!-- Coins Modal 2 -->
    <div id="coinsModalCreate" class="modal">
        <div class="modal-content">
            <h4 id="m-contractHeader">Available Coins</h4>
            <p id="m-contractType">Please tick the coins you would like to use...</p>
            <div id="aCoinsWrapper">

            </div>
        </div>
        <div class="modal-footer">
            <a class="modal-action modal-close waves-effect waves-red btn-flat">Cancel</a>
            <a id="aConfirmBtn" class="modal-action modal-close waves-effect waves-green btn-flat">Use Selected Coins</a>
        </div>
    </div>
        



        <script src="js/minima.js" type="text/javascript"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js" integrity="sha512-qTXRIMyZIFb8iQcfjXWCO8+M5Tbc38Qi5WzdPOYZHIlZpzBHG3L3by84BBBOiRGiEb7KKtAOAs5qYdUiZiQNNQ==" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/decimal.js/9.0.0/decimal.min.js" integrity="sha512-zPQm8HS4Phjo9pUbbk+HPH3rSWu5H03NFvBpPf6D9EU2xasj0ZxhYAc/lvv/HVDWMSE1Autj19i6nZOfiVQbFQ==" crossorigin="anonymous"></script>

    </body>
</html>